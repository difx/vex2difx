from edu.nrao.evla.observe import Mark5C
from edu.nrao.evla.observe import ESSR
from edu.nrao.evla.observe import MatrixSwitch
from edu.nrao.evla.observe import RDBE
from edu.nrao.evla.observe import VLBALoIfSetup
from edu.nrao.evla.observe import Parameters
from edu.nrao.evla.observe import bbc

second = 1.0/86400.0

deltat2 = 1

obsCode = 'GS032A1'
stnCode = 'FD'
mjdStart = 56556 + 53730*second

# File written by vex2script version 0.20 vintage 20130918

dbe0 = RDBE(0, 'ddc')
dbe0.setALC(1)
dbe0.setFormat('Mark5B')
dbe0.setPSNMode(0)
dbe0.setPacket(0, 0, 36, 5008)
subarray.setDBE(dbe0)

recorder0 = Mark5C('-1')
recorder0.setMode('Mark5B')
recorder0.setPSNMode(0)
recorder0.setPacket(0, 0, 36, 5008)
subarray.setRecorder(recorder0)

# XCUBE init
essr = ESSR()          # constructor
essr.setMode(4)        # one in, one out
essr.setRoute(2, 4)    # route incoming traffic from input 1 to output 1
essr.setPace(4, 5)     # set port 4 packet pacing to 5
subarray.setESSR(essr)

loif0 = VLBALoIfSetup() 
loif0.setIf('A', '6cm', 'R', 4100, 'U', 'NA', 0, '6cm', 15100, 4100, 736)
loif0.setIf('C', '6cm', 'L', 4100, 'U', 'NA', 0, '6cm', 15100, 4100, 736)
loif0.setPhaseCal(1)
loif0.setDBEParams(0, -1, -1, 10, 0)
loif0.setDBEParams(1, -1, -1, 10, 0)
loif0.setDBERemember(0, 1)
loif0.setDBERemember(1, 1)
channelSet0 = [ \
  bbc(0, 736, 16, 'L', 2, 0), \  # IF A
  bbc(1, 736, 16, 'L', 2, 0), \  # IF C
  bbc(0, 736, 16, 'U', 2, 0), \  # IF A
  bbc(1, 736, 16, 'U', 2, 0) \  # IF C
  ]

loif1 = VLBALoIfSetup() 
loif1.setIf('B', '1cm', 'R', 21500, 'U', 'NA', 12400, '1cm', 9100, 15100, 736)
loif1.setIf('D', '1cm', 'L', 21500, 'U', 'NA', 12400, '1cm', 9100, 15100, 736)
loif1.setPhaseCal(1)
loif1.setDBEParams(0, -1, -1, 10, 0)
loif1.setDBEParams(1, -1, -1, 10, 0)
loif1.setDBERemember(0, 1)
loif1.setDBERemember(1, 1)
channelSet1 = [ \
  bbc(0, 736, 16, 'L', 2, 0), \  # IF B
  bbc(1, 736, 16, 'L', 2, 0), \  # IF D
  bbc(0, 736, 16, 'U', 2, 0), \  # IF B
  bbc(1, 736, 16, 'U', 2, 0) \  # IF D
  ]

source0 = Source(3.14159265358979, 1.48352986419518)
source0.setName('FAKERA')

source1 = Source(0.832658765277936, 0.667558563941581)
source1.setName('0307+380')

source2 = Source(0.871803603444499, 0.724515766111718)
source2.setName('0316+413')

source3 = Source(1.04499751066008, 0.889488445014758)
source3.setName('0355+508')

# Setup Scan 
# Antenna FD not in scan No0001

# Scan 0 = No0001
# Antenna FD not in scan No0001

# Scan 1 = No0002
# Antenna FD not in scan No0002

# Scan 2 = No0003
# Antenna FD not in scan No0003

# Scan 3 = No0004
# Antenna FD not in scan No0004

# Scan 4 = No0005
# Antenna FD not in scan No0005

# Scan 5 = No0006
# changing to mode ra1cm2
subarray.setChannels(dbe0, channelSet1)
subarray.setVLBALoIfSetup(dbe0, loif1)
subarray.set4x4Switch('1A', 2)
subarray.set4x4Switch('1B', 4)
subarray.setSource(source2)
recorder0.setPacket(0, 0, 36, 5008)
subarray.setRecord(mjdStart + 270*second, mjdStart+540*second, 'No0006', obsCode, stnCode )
if array.time() < mjdStart + (540-10)*second:
  subarray.execute(mjdStart + 535*second)
else:
  print 'Skipping scan which ended at time ' + str(mjdStart+540*second) + ' since array.time is ' + str(array.time())

# Scan 6 = No0007
# changing to mode ra6cm2
subarray.setChannels(dbe0, channelSet0)
subarray.setVLBALoIfSetup(dbe0, loif0)
subarray.set4x4Switch('1A', 1)
subarray.set4x4Switch('1B', 3)
recorder0.setPacket(0, 0, 36, 5008)
subarray.setRecord(mjdStart + 570*second, mjdStart+840*second, 'No0007', obsCode, stnCode )
if array.time() < mjdStart + (840-10)*second:
  subarray.execute(mjdStart + 835*second)
else:
  print 'Skipping scan which ended at time ' + str(mjdStart+840*second) + ' since array.time is ' + str(array.time())

# Scan 7 = No0008
# Antenna FD not in scan No0008

# Scan 8 = No0009
# Antenna FD not in scan No0009

# Scan 9 = No0010
# Antenna FD not in scan No0010

# Scan 10 = No0011
# changing to mode ra1cm2
subarray.setChannels(dbe0, channelSet1)
subarray.setVLBALoIfSetup(dbe0, loif1)
subarray.set4x4Switch('1A', 2)
subarray.set4x4Switch('1B', 4)
recorder0.setPacket(0, 0, 36, 5008)
subarray.setRecord(mjdStart + 870*second, mjdStart+1440*second, 'No0011', obsCode, stnCode )
if array.time() < mjdStart + (1440-10)*second:
  subarray.execute(mjdStart + 1435*second)
else:
  print 'Skipping scan which ended at time ' + str(mjdStart+1440*second) + ' since array.time is ' + str(array.time())

# Scan 11 = No0012
# Antenna FD not in scan No0012

# Scan 12 = No0013
recorder0.setPacket(0, 0, 36, 5008)
subarray.setRecord(mjdStart + 1500*second, mjdStart+2070*second, 'No0013', obsCode, stnCode )
if array.time() < mjdStart + (2070-10)*second:
  subarray.execute(mjdStart + 2065*second)
else:
  print 'Skipping scan which ended at time ' + str(mjdStart+2070*second) + ' since array.time is ' + str(array.time())

# Scan 13 = No0014
# Antenna FD not in scan No0014

# Scan 14 = No0015
recorder0.setPacket(0, 0, 36, 5008)
subarray.setRecord(mjdStart + 2130*second, mjdStart+2670*second, 'No0015', obsCode, stnCode )
if array.time() < mjdStart + (2670-10)*second:
  subarray.execute(mjdStart + 2665*second)
else:
  print 'Skipping scan which ended at time ' + str(mjdStart+2670*second) + ' since array.time is ' + str(array.time())

# Scan 15 = No0016
# Antenna FD not in scan No0016

# Scan 16 = No0017
# Antenna FD not in scan No0017

# Scan 17 = No0018
# Antenna FD not in scan No0018

# Scan 18 = No0019
# Antenna FD not in scan No0019

# Scan 19 = No0020
subarray.setSource(source3)
recorder0.setPacket(0, 0, 36, 5008)
subarray.setRecord(mjdStart + 2775*second, mjdStart+2895*second, 'No0020', obsCode, stnCode )
if array.time() < mjdStart + (2895-10)*second:
  subarray.execute(mjdStart + 2890*second)
else:
  print 'Skipping scan which ended at time ' + str(mjdStart+2895*second) + ' since array.time is ' + str(array.time())

# Scan 20 = No0021
subarray.setSource(source1)
recorder0.setPacket(0, 0, 36, 5008)
subarray.setRecord(mjdStart + 2985*second, mjdStart+3105*second, 'No0021', obsCode, stnCode )
if array.time() < mjdStart + (3105-10)*second:
  subarray.execute(mjdStart + 3100*second)
else:
  print 'Skipping scan which ended at time ' + str(mjdStart+3105*second) + ' since array.time is ' + str(array.time())

# Scan 21 = No0022
# Antenna FD not in scan No0022

# Scan 22 = No0023
# Antenna FD not in scan No0023

# Scan 23 = No0024
subarray.setSource(source2)
recorder0.setPacket(0, 0, 36, 5008)
subarray.setRecord(mjdStart + 3135*second, mjdStart+3195*second, 'No0024', obsCode, stnCode )
if array.time() < mjdStart + (3195-10)*second:
  subarray.execute(mjdStart + 3190*second)
else:
  print 'Skipping scan which ended at time ' + str(mjdStart+3195*second) + ' since array.time is ' + str(array.time())

# Scan 24 = No0025
recorder0.setPacket(0, 0, 36, 5008)
subarray.setRecord(mjdStart + 3225*second, mjdStart+3540*second, 'No0025', obsCode, stnCode )
if array.time() < mjdStart + (3540-10)*second:
  subarray.execute(mjdStart + 3535*second)
else:
  print 'Skipping scan which ended at time ' + str(mjdStart+3540*second) + ' since array.time is ' + str(array.time())

# Scan 25 = No0026
# changing to mode ra6cm2
subarray.setChannels(dbe0, channelSet0)
subarray.setVLBALoIfSetup(dbe0, loif0)
subarray.set4x4Switch('1A', 1)
subarray.set4x4Switch('1B', 3)
recorder0.setPacket(0, 0, 36, 5008)
subarray.setRecord(mjdStart + 3570*second, mjdStart+3870*second, 'No0026', obsCode, stnCode )
if array.time() < mjdStart + (3870-10)*second:
  subarray.execute(mjdStart + 3865*second)
else:
  print 'Skipping scan which ended at time ' + str(mjdStart+3870*second) + ' since array.time is ' + str(array.time())

array.wait(mjdStart + 3871*second)
